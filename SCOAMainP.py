# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'SCOA.ui'
#
# Created by: PyQt5 UI code generator 5.15.4
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.

import sys
import pandas as pd
import numpy as np
import sklearn
import matplotlib
from keras.models import Sequential
from keras.layers import Dense
from keras.optimizers import Adam
from keras.layers import Dropout
from keras import regularizers
#import keras

import matplotlib.pyplot as plt
from pandas.plotting import scatter_matrix
import seaborn as sns

df = pd.read_csv('heart.csv')

# PREPROCESSING

data = df[~df.isin(['?'])]
data = data.dropna(axis=0)
data = data.apply(pd.to_numeric)

X = np.array(data.drop(['target'], 1))
y = np.array(data['target'])


# STANDARD SCALLING

mean = X.mean(axis=0)
X -= mean
std = X.std(axis=0)
X /= std

from sklearn import model_selection

X_train, X_test, y_train, y_test = model_selection.train_test_split(X, y, stratify=y, random_state=42, test_size = 0.2)

# create model
model = Sequential()
model.add(Dense(16, input_dim=13, kernel_initializer='normal',  kernel_regularizer=regularizers.l2(0.001),activation='relu'))
model.add(Dropout(0.25))
model.add(Dense(8, kernel_initializer='normal',  kernel_regularizer=regularizers.l2(0.001),activation='relu'))
model.add(Dropout(0.25))
model.add(Dense(1, activation='sigmoid'))
        
# Compile model
adam = Adam(lr=0.001)
model.compile(loss='binary_crossentropy', optimizer='rmsprop', metrics=['accuracy'])


#binary_model = create_binary_model()
history=model.fit(X_train, y_train, validation_data=(X_test, y_test), epochs=50, batch_size=10)

from PyQt5 import QtCore, QtGui, QtWidgets


class Ui_MainWindow(object):
    

    def predict(self):
        

        a1 = self.Age.text()
        a2 = self.Gender.currentText()
        if a2 == 'Male' :
            a22 = 0
        else :
            a22 = 1
        a3 = self.ChestPain.text()
        a4 = self.Threstbs.text()
        a5 = self.Cholestrol.text()
        a6 = self.BloodSugar.text()
        a7 = self.Electro.text()
        a8 = self.MaxHeartrate.text()
        a9 = self.Exercise.text()
        a10 = self.OldPeak.text()
        a11 = self.Slope.text()
        a12 = self.CA.text()
        a13 = self.Thal.text()

        a11 = int(a1)
        a33 = int(a3)
        a44 = int(a4)
        a55 = int(a5)
        a66 = int(a6)
        a77 = int(a7)
        a88 = int(a8)
        a99 = int(a9)
        a100 = int(a10)
        a111 = int(a11)
        a122 = int(a12)
        a133 = int(a13)
        
        var = [['age','sex','cp','trestbps','chol','fbs','restecg','thalach','exang','oldpeak','slope', 'ca','thal'],[a11,a22,a33,a44,a55,a66,a77,a88,a99,a100,a111,a122,a133]]
        var2 = var.pop(0)
        meanvar = pd.DataFrame(var, columns= var2)
        ans = model.predict(meanvar)
        print(ans)
        if ans == 1:
            str = "Yes"
        else :
            str = "NO"
        self.output.setText(str)
    
    def cleardata(self):
        self.Age.clear()
        self.ChestPain.clear()
        self.Threstbs.clear()
        self.Cholestrol.clear()
        self.BloodSugar.clear()
        self.Electro.clear()
        self.MaxHeartrate.clear()
        self.Exercise.clear()
        self.OldPeak.clear()
        self.Slope.clear()
        self.CA.clear()
        self.Thal.clear()
        self.output.clear()
    
    def frequency_plt(self):
        pd.crosstab(data.age,data.target).plot(kind="bar",figsize=(20,6))
        plt.title('Heart Disease Frequency for Ages')
        plt.xlabel('Age')
        plt.ylabel('Frequency')
        plt.show()

    def model_accuracy(self):
        plt.plot(history.history['accuracy'])
        plt.plot(history.history['val_accuracy'])
        plt.title('Model Accuracy')
        plt.ylabel('accuracy')
        plt.xlabel('epoch')
        plt.legend(['train', 'test'])
        plt.show()

    def model_loss(self):
        plt.plot(history.history['loss'])
        plt.plot(history.history['val_loss'])
        plt.title('Model Loss')
        plt.ylabel('loss')
        plt.xlabel('epoch')
        plt.legend(['train', 'test'])
        plt.show()

    def hist(self):
        data.hist(figsize = (12, 12))
        plt.show()

    def corr(self):
        plt.figure(figsize=(10,10))
        sns.heatmap(data.corr(),annot=True,fmt='.1f')
        plt.show()

    def setupUi(self, MainWindow):
        MainWindow.setObjectName("MainWindow")
        MainWindow.resize(892, 789)
        self.centralwidget = QtWidgets.QWidget(MainWindow)
        self.centralwidget.setObjectName("centralwidget")
        self.heading = QtWidgets.QLabel(self.centralwidget)
        self.heading.setGeometry(QtCore.QRect(310, 260, 611, 61))
        font = QtGui.QFont()
        font.setPointSize(26)
        self.heading.setFont(font)
        self.heading.setText("")
        self.heading.setObjectName("heading")
        self.bagroundcolor = QtWidgets.QLabel(self.centralwidget)
        self.bagroundcolor.setGeometry(QtCore.QRect(10, 10, 871, 751))
        self.bagroundcolor.setStyleSheet("background-color: rgb(255, 238, 216);")
        self.bagroundcolor.setText("")
        self.bagroundcolor.setObjectName("bagroundcolor")
        self.label = QtWidgets.QLabel(self.centralwidget)
        self.label.setGeometry(QtCore.QRect(140, -10, 811, 121))
        font = QtGui.QFont()
        font.setPointSize(26)
        font.setBold(False)
        font.setWeight(50)
        self.label.setFont(font)
        self.label.setObjectName("label")
        self.label_2 = QtWidgets.QLabel(self.centralwidget)
        self.label_2.setGeometry(QtCore.QRect(60, 150, 71, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_2.setFont(font)
        self.label_2.setObjectName("label_2")
        self.label_3 = QtWidgets.QLabel(self.centralwidget)
        self.label_3.setGeometry(QtCore.QRect(60, 190, 71, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_3.setFont(font)
        self.label_3.setObjectName("label_3")
        self.label_4 = QtWidgets.QLabel(self.centralwidget)
        self.label_4.setGeometry(QtCore.QRect(60, 230, 101, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_4.setFont(font)
        self.label_4.setObjectName("label_4")
        self.label_5 = QtWidgets.QLabel(self.centralwidget)
        self.label_5.setGeometry(QtCore.QRect(60, 270, 101, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_5.setFont(font)
        self.label_5.setObjectName("label_5")
        self.label_6 = QtWidgets.QLabel(self.centralwidget)
        self.label_6.setGeometry(QtCore.QRect(60, 310, 111, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_6.setFont(font)
        self.label_6.setObjectName("label_6")
        self.label_7 = QtWidgets.QLabel(self.centralwidget)
        self.label_7.setGeometry(QtCore.QRect(60, 350, 111, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_7.setFont(font)
        self.label_7.setObjectName("label_7")
        self.label_8 = QtWidgets.QLabel(self.centralwidget)
        self.label_8.setGeometry(QtCore.QRect(60, 390, 201, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_8.setFont(font)
        self.label_8.setObjectName("label_8")
        self.label_9 = QtWidgets.QLabel(self.centralwidget)
        self.label_9.setGeometry(QtCore.QRect(60, 430, 201, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_9.setFont(font)
        self.label_9.setObjectName("label_9")
        self.label_10 = QtWidgets.QLabel(self.centralwidget)
        self.label_10.setGeometry(QtCore.QRect(460, 150, 221, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_10.setFont(font)
        self.label_10.setObjectName("label_10")
        self.label_11 = QtWidgets.QLabel(self.centralwidget)
        self.label_11.setGeometry(QtCore.QRect(460, 190, 221, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_11.setFont(font)
        self.label_11.setObjectName("label_11")
        self.label_12 = QtWidgets.QLabel(self.centralwidget)
        self.label_12.setGeometry(QtCore.QRect(460, 230, 221, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_12.setFont(font)
        self.label_12.setObjectName("label_12")
        self.label_13 = QtWidgets.QLabel(self.centralwidget)
        self.label_13.setGeometry(QtCore.QRect(460, 270, 221, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_13.setFont(font)
        self.label_13.setObjectName("label_13")
        self.label_14 = QtWidgets.QLabel(self.centralwidget)
        self.label_14.setGeometry(QtCore.QRect(460, 310, 221, 31))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_14.setFont(font)
        self.label_14.setObjectName("label_14")
        self.Age = QtWidgets.QLineEdit(self.centralwidget)
        self.Age.setGeometry(QtCore.QRect(300, 150, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.Age.setFont(font)
        self.Age.setObjectName("Age")
        self.Gender = QtWidgets.QComboBox(self.centralwidget)
        self.Gender.setGeometry(QtCore.QRect(300, 190, 73, 22))
        font = QtGui.QFont()
        font.setPointSize(10)
        self.Gender.setFont(font)
        self.Gender.setObjectName("Gender")
        self.Gender.addItem("")
        self.Gender.addItem("")
        self.ChestPain = QtWidgets.QLineEdit(self.centralwidget)
        self.ChestPain.setGeometry(QtCore.QRect(300, 230, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.ChestPain.setFont(font)
        self.ChestPain.setObjectName("ChestPain")
        self.Threstbs = QtWidgets.QLineEdit(self.centralwidget)
        self.Threstbs.setGeometry(QtCore.QRect(300, 270, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.Threstbs.setFont(font)
        self.Threstbs.setObjectName("Threstbs")
        self.Cholestrol = QtWidgets.QLineEdit(self.centralwidget)
        self.Cholestrol.setGeometry(QtCore.QRect(300, 310, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.Cholestrol.setFont(font)
        self.Cholestrol.setObjectName("Cholestrol")
        self.BloodSugar = QtWidgets.QLineEdit(self.centralwidget)
        self.BloodSugar.setGeometry(QtCore.QRect(300, 350, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.BloodSugar.setFont(font)
        self.BloodSugar.setObjectName("BloodSugar")
        self.Electro = QtWidgets.QLineEdit(self.centralwidget)
        self.Electro.setGeometry(QtCore.QRect(300, 390, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.Electro.setFont(font)
        self.Electro.setObjectName("Electro")
        self.MaxHeartrate = QtWidgets.QLineEdit(self.centralwidget)
        self.MaxHeartrate.setGeometry(QtCore.QRect(300, 430, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.MaxHeartrate.setFont(font)
        self.MaxHeartrate.setObjectName("MaxHeartrate")
        self.Exercise = QtWidgets.QLineEdit(self.centralwidget)
        self.Exercise.setGeometry(QtCore.QRect(710, 160, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.Exercise.setFont(font)
        self.Exercise.setObjectName("Exercise")
        self.OldPeak = QtWidgets.QLineEdit(self.centralwidget)
        self.OldPeak.setGeometry(QtCore.QRect(710, 200, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.OldPeak.setFont(font)
        self.OldPeak.setObjectName("OldPeak")
        self.Slope = QtWidgets.QLineEdit(self.centralwidget)
        self.Slope.setGeometry(QtCore.QRect(710, 240, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.Slope.setFont(font)
        self.Slope.setObjectName("Slope")
        self.CA = QtWidgets.QLineEdit(self.centralwidget)
        self.CA.setGeometry(QtCore.QRect(710, 280, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.CA.setFont(font)
        self.CA.setObjectName("CA")
        self.Thal = QtWidgets.QLineEdit(self.centralwidget)
        self.Thal.setGeometry(QtCore.QRect(710, 320, 113, 22))
        font = QtGui.QFont()
        font.setPointSize(9)
        self.Thal.setFont(font)
        self.Thal.setObjectName("Thal")
        self.pushButton = QtWidgets.QPushButton(self.centralwidget)
        self.pushButton.setGeometry(QtCore.QRect(460, 370, 171, 51))
        font = QtGui.QFont()
        font.setPointSize(11)
        font.setBold(False)
        font.setWeight(50)
        self.pushButton.setFont(font)
        self.pushButton.setObjectName("pushButton")
        self.pushButton.clicked.connect(self.predict)


        self.pushButton_2 = QtWidgets.QPushButton(self.centralwidget)
        self.pushButton_2.setGeometry(QtCore.QRect(360, 500, 171, 51))
        font = QtGui.QFont()
        font.setPointSize(11)
        self.pushButton_2.setFont(font)
        self.pushButton_2.setObjectName("pushButton_2")
        self.pushButton_2.clicked.connect(self.frequency_plt)


        self.histogram = QtWidgets.QPushButton(self.centralwidget)
        self.histogram.setGeometry(QtCore.QRect(580, 500, 171, 51))
        font = QtGui.QFont()
        font.setPointSize(11)
        self.histogram.setFont(font)
        self.histogram.setObjectName("histogram")
        self.histogram.clicked.connect(self.hist)


        self.output = QtWidgets.QLineEdit(self.centralwidget)
        self.output.setGeometry(QtCore.QRect(690, 370, 131, 51))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.output.setFont(font)
        self.output.setObjectName("output")
        self.pushButton_3 = QtWidgets.QPushButton(self.centralwidget)
        self.pushButton_3.setGeometry(QtCore.QRect(460, 580, 211, 51))
        font = QtGui.QFont()
        font.setPointSize(11)
        self.pushButton_3.setFont(font)
        self.pushButton_3.setObjectName("pushButton_3")
        self.pushButton_3.clicked.connect(self.corr)



        self.pushButton_4 = QtWidgets.QPushButton(self.centralwidget)
        self.pushButton_4.setGeometry(QtCore.QRect(360, 670, 171, 51))
        font = QtGui.QFont()
        font.setPointSize(11)
        self.pushButton_4.setFont(font)
        self.pushButton_4.setObjectName("pushButton_4")
        self.pushButton_4.clicked.connect(self.model_accuracy)
        
        self.clear = QtWidgets.QPushButton(self.centralwidget)
        self.clear.setGeometry(QtCore.QRect(720, 580, 101, 51))
        font = QtGui.QFont()
        font.setPointSize(11)
        self.clear.setFont(font)
        self.clear.setObjectName("clear")
        self.clear.clicked.connect(self.cleardata)
        


        self.pushButton_5 = QtWidgets.QPushButton(self.centralwidget)
        self.pushButton_5.setGeometry(QtCore.QRect(590, 670, 171, 51))
        font = QtGui.QFont()
        font.setPointSize(11)
        self.pushButton_5.setFont(font)
        self.pushButton_5.setObjectName("pushButton_5")
        self.pushButton_5.clicked.connect(self.model_loss)


        
        self.textEdit = QtWidgets.QTextEdit(self.centralwidget)
        self.textEdit.setGeometry(QtCore.QRect(50, 530, 231, 211))
        self.textEdit.setObjectName("textEdit")
        self.label_15 = QtWidgets.QLabel(self.centralwidget)
        self.label_15.setGeometry(QtCore.QRect(110, 500, 101, 16))
        font = QtGui.QFont()
        font.setPointSize(12)
        self.label_15.setFont(font)
        self.label_15.setObjectName("label_15")
        MainWindow.setCentralWidget(self.centralwidget)
        self.menubar = QtWidgets.QMenuBar(MainWindow)
        self.menubar.setGeometry(QtCore.QRect(0, 0, 892, 26))
        self.menubar.setObjectName("menubar")
        MainWindow.setMenuBar(self.menubar)
        self.statusbar = QtWidgets.QStatusBar(MainWindow)
        self.statusbar.setObjectName("statusbar")
        MainWindow.setStatusBar(self.statusbar)

        self.retranslateUi(MainWindow)
        QtCore.QMetaObject.connectSlotsByName(MainWindow)

    def retranslateUi(self, MainWindow):
        _translate = QtCore.QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "HeartDiseaseNN"))
        self.label.setText(_translate("MainWindow", "HEART DISEASE PREDICTION"))
        self.label_2.setText(_translate("MainWindow", "Age "))
        self.label_3.setText(_translate("MainWindow", "Gender"))
        self.label_4.setText(_translate("MainWindow", "Chest Pain"))
        self.label_5.setText(_translate("MainWindow", "Threstbps"))
        self.label_6.setText(_translate("MainWindow", "Cholestrol"))
        self.label_7.setText(_translate("MainWindow", "Blood Sugar"))
        self.label_8.setText(_translate("MainWindow", "Electrocardiographic "))
        self.label_9.setText(_translate("MainWindow", "Max Heart Rate "))
        self.label_10.setText(_translate("MainWindow", "Exercise Induced Angina"))
        self.label_11.setText(_translate("MainWindow", "Old Peak"))
        self.label_12.setText(_translate("MainWindow", "Slope "))
        self.label_13.setText(_translate("MainWindow", "CA"))
        self.label_14.setText(_translate("MainWindow", "Thal"))
        self.Gender.setItemText(0, _translate("MainWindow", "Male "))
        self.Gender.setItemText(1, _translate("MainWindow", "Female"))
        self.pushButton.setText(_translate("MainWindow", "PREDICT"))
        self.pushButton_2.setText(_translate("MainWindow", "FREQUENCY"))
        self.histogram.setText(_translate("MainWindow", "HISTOGRAM"))
        self.pushButton_3.setText(_translate("MainWindow", "CORELATION MATRIX"))
        self.pushButton_4.setText(_translate("MainWindow", "MODEL ACCURACY"))
        self.pushButton_5.setText(_translate("MainWindow", "MODEL LOSS"))
        self.textEdit.setHtml(_translate("MainWindow", "<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0//EN\" \"http://www.w3.org/TR/REC-html40/strict.dtd\">\n"
"<html><head><meta name=\"qrichtext\" content=\"1\" /><style type=\"text/css\">\n"
"p, li { white-space: pre-wrap; }\n"
"</style></head><body style=\" font-family:\'MS Shell Dlg 2\'; font-size:7.8pt; font-weight:400; font-style:normal;\">\n"
"<p align=\"center\" style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-size:12pt;\">CP : 0 - 3</span></p>\n"
"<p align=\"center\" style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-size:12pt;\">tresbps : 94 - 200 </span></p>\n"
"<p align=\"center\" style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-size:12pt;\">cholestrol : 126 - 564</span></p>\n"
"<p align=\"center\" style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-size:12pt;\">fps : 0 - 1 </span></p>\n"
"<p align=\"center\" style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-size:12pt;\">restecg : 0 - 2 </span></p>\n"
"<p align=\"center\" style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-size:12pt;\">thalach : 71 - 202</span></p>\n"
"<p align=\"center\" style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-size:12pt;\">exang : 0 - 1 </span></p>\n"
"<p align=\"center\" style=\" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;\"><span style=\" font-size:12pt;\">oldpeak : 0 - 6.2</span></p></body></html>"))
        self.label_15.setText(_translate("MainWindow", "RANGE"))
        self.clear.setText(_translate("MainWindow", "CLEAR"))


if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    MainWindow = QtWidgets.QMainWindow()
    ui = Ui_MainWindow()
    ui.setupUi(MainWindow)
    MainWindow.show()
    sys.exit(app.exec_())
